version: '3'

services:

##################### Rails #####################
    workspace:
      build:
        context: ./workspace
        args:
          - RUBY_VERSION=${RUBY_VERSION}
      volumes:
        - ${RAILS_CODE_PATH}:/usr/src/rails
      depends_on:
        - mysql
        - postgres
        - redis
        - memcached

##################### MySQL #####################
    mysql:
      image: mysql:${MYSQL_VERSION}
      command: --default-authentication-plugin=mysql_native_password
      restart: always
      volumes:
        - mysql:/var/lib/mysql
      environment:
        MYSQL_ROOT_PASSWORD: root

##################### Postgres #####################
    postgres:
      build:
        context: ./postgres

##################### Redis #####################
    redis:
      build:
        context: ./redis

##################### Memcached #####################
    memcached:
      build:
        context: ./memcached

volumes:
  mysql:
    driver: local
